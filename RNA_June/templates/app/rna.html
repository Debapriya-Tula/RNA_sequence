<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <title>RNA Prediction</title>

</head>
<body background="{% static 'app/rna_t.jpg' %}" id='main-body'>
    <script>
        function validate_form(){
            var x = document.forms["myForm"]["input"].value;
            x = new Set(x.toString());
            var main = new Set("augct");
            var z = new Set([...x].filter(y => !main.has(y)));
            if(z.size!=0){
                alert("Unknown bases entered!");
                return false;
            }

            var checked=false;
            var elements = document.getElementsByName("base");
            for(var i=0; i < elements.length; i++){
                if(elements[i].checked) {
                    checked = true;
                }
            }
            if (!checked) {
                alert('Select at least one of the base-pairs!');
                return false;
            }

        if ("{{message}}"){
            alert("{{message}}");
            return false;
        }
        }
    </script>
    <center>
        <div class="jumbotron jumbotron-fluid">
                <div class="container" style='max-height: 1em;'>
                    <h1>RNA Secondary Structure Prediction</h1>      
                </div>
        </div>
        
        <form name="myForm" action="{% url 'app:predict'%}" method="POST" onsubmit="return validate_form()">
            {% csrf_token %}
            <table style="text-align: center" cellspacing="1">
              <tr>
                <td><h6><b>Enter the sequence: <input type="text" minlength="5" name="input"></b></h6></td>
                <td><h6><b>Enter the .x sequence: <input type="text" minlength="5" name="keep_seq"></b></h6></td>
              </tr>
              <tr>
                  <td colspan="2"><hr><h4><b>OR</b></h4></td>
              </tr>
              <tr>
                <td><h6><b>Select a text(.txt) file to upload(keep file in HOME folder) <input type="file" name="f1"></b></h6></td>
                <td><h6><b>Select a text file for .x sequence(keep file in HOME folder) <input type="file" name="keep_seq_file"></b></h6><br></td>
              </tr>
            </table>
            
            <hr>
            <h6><b>Select the base pairs to keep:</b>
            <input type="checkbox" name="base" value="GU" checked> G-U &nbsp;
            <input type="checkbox" name="base" value="AU" checked> A-U &nbsp;
            <input type="checkbox" name="base" value="GC" checked> G-C &nbsp;
            </h6><br>

            <hr>
            <h6><b>Choose the algorithm:</b>
                <input type="radio" name="algo" value="self" checked> Our method &nbsp;
                <input type="radio" name="algo" value="olke"> Olke &nbsp;
                <input type="radio" name="algo" value="neural"> Neural &nbsp;
            </h6><br>
            <hr>
            <h6><b>Please enter your email id so that we can mail you the results once calculated:
                <input type="email" name="mail"><b></h6> <br><br>
            <input type="submit" name="" value="Submit">
        </form>
        <hr>
        <br><br>
        <h3> Dot bracket forms:</h3>
        <textarea cols="100" rows="3">
            {% for seq in res %}
                {{seq}}
            {% endfor %}
        </textarea>
        <br><hr><br>
        <h3> Graphs: </h3>
        <div style="width:1000;height:100">
            {% for index,plot in dot_bracket %}
                <img src="data:image/png;base64, {{ plot.0 }}">
                <p>
                    <a href="http://nibiru.tbi.univie.ac.at/forna/forna.html?id=fasta&file=>header\n{{sequence}}\n{{plot.1}}"  
                        target="_blank">
                        Click here to visualize the structure
                    </a>
                </p>

            {% endfor %}
        </div>

    </center>
</body>
</html>